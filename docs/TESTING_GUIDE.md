# 行空板紫外线传感器扩展测试指南

本指南将帮助您测试新生成的行空板紫外线传感器扩展包，确保其在实际环境中正常工作。

## 1. 测试环境准备

### 1.1 硬件准备

- 行空板(UniHiker)主机
- 紫外线传感器(DFRobot 240370)
- 数据线和连接线

### 1.2 软件准备

- 最新版 Mind+软件
- 生成的扩展包文件: `dfrobot-uvindex240370sensor-unihiker-V1.0.0.mpext`
- 如有条件，准备 SSH 客户端以连接行空板

## 2. 硬件连接测试

### 2.1 传感器连接

1. 将紫外线传感器按以下方式连接到行空板:

   | 传感器引脚 | 行空板引脚 |
   | ---------- | ---------- |
   | VCC        | 3.3V       |
   | GND        | GND        |
   | SDA        | SDA (I2C)  |
   | SCL        | SCL (I2C)  |

2. 确认连接稳固，没有虚接或短路

### 2.2 I2C 设备检测

如果可以通过 SSH 连接到行空板，可执行以下命令检测 I2C 设备:

```bash
sudo i2cdetect -y 4
```

应该可以看到地址 0x23(或 0x38)处有设备响应。

## 3. 扩展包安装测试

### 3.1 导入扩展包

1. 打开 Mind+软件
2. 点击"扩展"按钮
3. 选择"本地"选项卡
4. 导入生成的扩展包文件

### 3.2 验证扩展是否正确加载

1. 导入成功后，在扩展列表中应该显示"紫外线传感器"
2. 添加扩展后，积木工具箱中应出现紫外线传感器分类
3. 检查积木块是否完整，应该包含初始化和读取功能

## 4. 基础功能测试

创建一个简单的测试项目:

### 4.1 创建测试程序

使用 Mind+创建如下程序:

```blocks
当行空板启动
  初始化紫外线传感器
  重复执行
    变量 raw = 读取紫外线[原始数据]
    变量 uv = 读取紫外线[UV指数]
    变量 risk = 读取紫外线[风险等级]

    在LCD上显示文本 "原始值: " + raw 在位置 x:10 y:20
    在LCD上显示文本 "UV指数: " + uv 在位置 x:10 y:40
    在LCD上显示文本 "风险等级: " + risk 在位置 x:10 y:60

    等待1秒
```

### 4.2 上传测试

1. 将程序上传到行空板
2. 观察是否正常运行，没有报错
3. 验证 LCD 上是否显示了预期的数据

## 5. 进阶功能测试

### 5.1 直接 Python 文件测试

将以下测试脚本上传到行空板:

```bash
scp /Users/gaopeng/Desktop/UvIndex240370Sensor_New/examples/basic_uv_example.py root@<行空板IP地址>:/root/
```

然后在行空板上运行:

```bash
python /root/basic_uv_example.py
```

验证是否能正常输出紫外线数据。

### 5.2 GUI 界面测试

上传并运行 GUI 示例:

```bash
scp /Users/gaopeng/Desktop/UvIndex240370Sensor_New/examples/gui_uv_monitor.py root@<行空板IP地址>:/root/
python /root/gui_uv_monitor.py
```

验证是否能在行空板屏幕上显示图形化界面和紫外线数据。

## 6. 错误处理测试

### 6.1 断开传感器测试

1. 运行程序的同时断开传感器连接
2. 验证程序是否有合理的错误处理
3. 重新连接传感器，验证程序是否能恢复工作

### 6.2 模拟模式测试

修改示例程序中的代码，将模拟模式设为 True:

```python
# 创建传感器对象
uv_sensor = PatchUVSensor(simulation_mode=True)
```

验证在没有实际硬件的情况下是否能模拟输出数据。

## 7. 环境测试

### 7.1 不同光照条件

在不同光照条件下测试传感器:

- 室内普通灯光
- 阴天户外
- 晴天户外
- 阴影区域

记录并比较不同条件下的数值差异。

### 7.2 对比测试

如果有其他 UV 测量设备，可以进行对比测试:

1. 同时使用不同设备在相同条件下测量
2. 比较测量结果，评估准确性

## 8. 常见问题排查

### 8.1 无法读取数据

可能的解决方法:

- 检查硬件连接
- 验证 I2C 地址是否正确
- 检查行空板是否正确识别设备
- 尝试重启行空板
- 检查传感器供电是否稳定

### 8.2 数据异常

如果读取到的数据异常:

- 检查光照条件是否合理
- 确认传感器型号和库文件匹配
- 尝试使用原始数据进行计算和验证

## 9. 测试报告

完成测试后，建议记录以下信息:

- 测试日期和环境
- 硬件和软件版本
- 测试过的功能及结果
- 发现的问题和解决方法
- 改进建议

## 10. 反馈渠道

如有任何问题或建议，请联系:

- 电子邮件: gaopeng@lekee.cc
- 官方网站: https://www.dfrobot.com
